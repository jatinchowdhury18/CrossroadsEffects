# Crossroads Effects

[![Build Status](https://travis-ci.com/jatinchowdhury18/CrossroadsEffects.svg?token=Ub9niJrqG1Br1qaaxp7E&branch=master)](https://travis-ci.com/jatinchowdhury18/CrossroadsEffects)

This repository contains a system (still in developement)
for auto-generating audio effects for a given input and
output audio file. More technically, the system uses a `Python`
script to generate `Faust` code that compiles to create audio
effects. The `Faust` code is then optimized to create an effect
that best approximates the desired output, using a variety of
optimiztion schemes as well as genetic algorithms.

## Using

This project is still in the early stages of development.
To test that the system is working on your machine, run
`run_tests.sh --quick`.

### Dependencies

To use `Crossroads`, you must have the following dependencies
installed:

- [`Python`](https://www.python.org/)
- `Python` packages (`pip install -r requirements.txt`)
- [`Faust`](https://github.com/grame-cncm/faust)
- Mac/Linux only
  - Boost (`sudo apt-get install libboost-all-dev`)
- Windows only
  - [MSYS2](https://www.msys2.org/)

If you don't already have `Faust` installed, it is included in 
this repo and can be installed as follows (this requires CMAKE):

```bash
# Starting from the root directory of this repo
cd modules/Faust
make
sudo make install
```

### Installation
```bash
# clone repo
git clone https://github.com/jatinchowdhury18/CrossroadsEffects.git
cd CrossroadsEffects

# initialize submodules
git submodule update --init --recursive

# If you don't already have Faust installed (requires cmake)
cd modules/Faust/
make
sudo make install
cd ../../

# Run tests (this will take a few minutes)
./run_tests.sh --quick
```

### Running

To use Crossroads, you must have an input audio file, and a
desired output audio file. Crossroads will attempt to generate
an audio effect that can create the desired output from the given
input. As an example, the `audio_files/` directory contains
a drum sample (`drums.wav`), and the same sample with a lower
volume (`gain.wav`).

```bash
# Run `python crossroads.py --name=<EffectName> <input file> <desired output file>`
# (this will take a couple hours)
python crossroads.py --name=MyGain audio_files/drums.wav audio_files/gain.wav
```
Crossroads will generate a folder called `MyGain` that contains
`Faust` code, VST plugins, and SVG block diagrams generated by 
Crossroads.

## How It Works

Crossroads uses a genetic algorithm to generate signal processing
structures, made up of gain and delay elements. A gradient-based
optimizer (L-BFGS-B) is then used to tune the parameters of each 
structure. Crossroads generates `Faust` code for each structure,
then compiles a VST plugin, and runs the input audio through the
plugin. The output audio is then compared to the desired audio
using a combination of time-domain and frequency-domain error
functions. Finally, the results of the error functions are fed
back to the genetic algorithm which generates a new generation
of structures.

### Current Status and Future Work

Currently Crossroads is only configured to generate linear
feedforward systems. The foundations exist to generate systems
that contain feedback, but the parameter estimation step currently
has difficulty with feedback systems that have multiple poles.
We plan to start adding nonlinear elements in the near future.

## About the name

In German legend, a character named Faust makes a deal with
the devil, to give up his soul for unlimited knowledge and all
the pleasures he can imagine. In Blues legend, Robert Johnson 
makes a deal with the devil to become the greatest Blues guitarist
of all time, in exchange for his soul. In audio programming, 
signal processing engineers are making a deal with the devil to
give up creating their own DSP algorithms in exchange for machine
learning algorithms that accomplish these signal processing tasks
for them. In each case, the deal with the devil always takes place
at a crossroads . . .

## License

GPL??
